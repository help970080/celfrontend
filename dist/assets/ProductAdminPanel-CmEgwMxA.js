import{r,j as e,y as R}from"./index-BrUxmOLQ.js";const E="https://cel1.onrender.com";function W({onProductAdded:A,productToEdit:t,setProductToEdit:p}){const[h,x]=r.useState(""),[I,j]=r.useState(""),[S,v]=r.useState(""),[$,y]=r.useState(""),[u,N]=r.useState(""),[P,C]=r.useState(""),[f,w]=r.useState(""),[c,B]=r.useState(!1),[d,o]=r.useState(null),[b,F]=r.useState(null);r.useEffect(()=>{t?(x(t.name||""),j(t.description||""),v(t.price||""),y(t.stock||""),N(Array.isArray(t.imageUrls)?t.imageUrls.join(`
`):t.imageUrls||""),C(t.category||""),w(t.brand||"")):m()},[t]);const m=()=>{x(""),j(""),v(""),y(""),N(""),C(""),w(""),o(null),F(null),p&&p(null)},D=async a=>{a.preventDefault(),B(!0),o(null),F(null);const _=u.split(/[\n,]/).map(n=>n.trim()).filter(n=>n!==""),U={name:h,description:I,price:parseFloat(S),stock:parseInt($,10),imageUrls:_,category:P,brand:f},L=t?`${E}/api/products/${t.id}`:`${E}/api/products`,k=t?"PUT":"POST";try{const n=await fetch(L,{method:k,headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(U)});if(!n.ok){const s=await n.json();throw new Error(s.message||`Error HTTP: ${n.status}`)}const M=await n.json();F(t?"Producto actualizado con éxito!":"Producto agregado con éxito!"),R.success(t?"Producto actualizado!":"Producto agregado!"),A(M),m()}catch(n){console.error("Error al guardar producto:",n),o(n.message||"Error al guardar el producto. Intenta de nuevo."),R.error("Ocurrió un error al guardar el producto.")}finally{B(!1)}};return e.jsxs("div",{className:"product-form-container",children:[e.jsx("h2",{children:t?"Editar Producto":"Agregar Nuevo Producto"}),e.jsxs("form",{onSubmit:D,className:"product-form",children:[d&&e.jsx("p",{className:"error-message",children:d}),b&&e.jsx("p",{className:"success-message",children:b}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"name",children:"Nombre:"}),e.jsx("input",{type:"text",id:"name",value:h,onChange:a=>x(a.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"description",children:"Descripción:"}),e.jsx("textarea",{id:"description",value:I,onChange:a=>j(a.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"price",children:"Precio:"}),e.jsx("input",{type:"number",id:"price",value:S,onChange:a=>v(a.target.value),step:"0.01",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"stock",children:"Existencias:"}),e.jsx("input",{type:"number",id:"stock",value:$,onChange:a=>y(a.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"imageUrls",children:"URLs de Imágenes/Videos (una por línea o separadas por comas):"}),e.jsx("textarea",{id:"imageUrls",value:u,onChange:a=>N(a.target.value),placeholder:`Pega las URLs de las imágenes o videos aquí, una por línea o separadas por comas. Ej:\r
https://example.com/img1.jpg\r
https://example.com/video.mp4\r
https://example.com/img2.png`,rows:"4"}),e.jsx("p",{className:"hint-text",children:"Cada URL en una nueva línea o separadas por comas."})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"category",children:"Categoría:"}),e.jsx("input",{type:"text",id:"category",value:P,onChange:a=>C(a.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"brand",children:"Marca:"}),e.jsx("input",{type:"text",id:"brand",value:f,onChange:a=>w(a.target.value)})]}),e.jsx("button",{type:"submit",disabled:c,children:c?"Guardando...":t?"Actualizar Producto":"Agregar Producto"}),t&&e.jsx("button",{type:"button",onClick:m,disabled:c,className:"cancel-button",children:"Cancelar Edición"})]})]})}const X="https://cel1.onrender.com";function H({authenticatedFetch:A,onDeleteProduct:t,userRole:p}){const[h,x]=r.useState([]),[I,j]=r.useState(!0),[S,v]=r.useState(null),[$,y]=r.useState(null),[u,N]=r.useState(""),[P,C]=r.useState("name"),[f,w]=r.useState("asc"),[c,B]=r.useState(""),[d,o]=r.useState(1),[b,F]=r.useState(10),[m,D]=r.useState(1),[a,_]=r.useState(0),U=s=>p?Array.isArray(s)?s.includes(p):p===s:!1,L=s=>{const l=s*.1,O=(s-l)/17;return{downPayment:parseFloat(l.toFixed(2)),weeklyPayment:parseFloat(O.toFixed(2))}},k=r.useCallback(async()=>{j(!0),v(null);try{let s=`${X}/api/products?sortBy=${P}&order=${f}`;c&&(s+=`&category=${encodeURIComponent(c)}`),u&&(s+=`&search=${encodeURIComponent(u)}`),s+=`&page=${d}&limit=${b}`;const i=await A(s);if(!i.ok){const l=await i.json();throw new Error(l.message||`Error HTTP: ${i.status}`)}const g=await i.json();x(g.products||[]),D(g.totalPages),_(g.totalItems)}catch(s){console.error("Error al obtener productos:",s),v(s.message||"No se pudieron cargar los productos."),x([])}finally{j(!1)}},[A,u,P,f,c,d,b]);r.useEffect(()=>{k()},[k]);const n=[...new Set(h.map(s=>s.category).filter(Boolean))],M=s=>s?s.includes("youtube.com/watch?v=")||s.includes("youtu.be/")?{type:"youtube",id:(s.split("v=")[1]||s.split("/").pop()).split("&")[0]}:s.includes("vimeo.com/")?{type:"vimeo",id:s.split("/").pop().split("?")[0]}:{type:"image"}:"none";return e.jsxs("section",{className:"products-section",children:[e.jsx("h2",{children:"Gestión de Productos"}),U(["super_admin","regular_admin","inventory_admin"])&&e.jsx(W,{onProductAdded:k,productToEdit:$,setProductToEdit:y}),e.jsxs("div",{className:"admin-controls",children:[e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"searchProduct",children:"Buscar:"}),e.jsx("input",{type:"text",id:"searchProduct",value:u,onChange:s=>{N(s.target.value),o(1)},placeholder:"Buscar por nombre, descripción, categoría, marca..."})]}),e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"sortBy",children:"Ordenar por:"}),e.jsxs("select",{id:"sortBy",value:P,onChange:s=>{C(s.target.value),o(1)},children:[e.jsx("option",{value:"name",children:"Nombre (A-Z)"}),e.jsx("option",{value:"price",children:"Precio"}),e.jsx("option",{value:"createdAt",children:"Más Recientes"})]})]}),e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"order",children:"Orden:"}),e.jsxs("select",{id:"order",value:f,onChange:s=>{w(s.target.value),o(1)},children:[e.jsx("option",{value:"asc",children:"Ascendente"}),e.jsx("option",{value:"desc",children:"Descendente"})]})]}),e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"categoryFilter",children:"Categoría:"}),e.jsxs("select",{id:"categoryFilter",value:c,onChange:s=>{B(s.target.value),o(1)},children:[e.jsx("option",{value:"",children:"Todas"}),n.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"itemsPerPage",children:"Ítems por página:"}),e.jsxs("select",{id:"itemsPerPage",value:b,onChange:s=>{F(parseInt(s.target.value,10)),o(1)},children:[e.jsx("option",{value:"5",children:"5"}),e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"})]})]})]}),I?e.jsx("p",{children:"Cargando productos..."}):S?e.jsxs("p",{style:{color:"red",fontWeight:"bold"},children:["Error: ",S]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"product-list",children:h.length===0?e.jsx("p",{children:"No hay productos que coincidan con los criterios de búsqueda o filtro."}):h.map(s=>{const i=Array.isArray(s.imageUrls)?s.imageUrls:typeof s.imageUrls=="string"&&s.imageUrls?s.imageUrls.split(/[\n,]/).map(z=>z.trim()).filter(Boolean):[],g=i.length>0?i[0]:"https://via.placeholder.com/150",l=M(g),{downPayment:q,weeklyPayment:O}=L(s.price);return e.jsxs("div",{className:"product-card",children:[l.type==="youtube"?e.jsx("iframe",{width:"100%",height:"150",src:`https://www.youtube.com/embed/${l.id}`,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,title:s.name}):l.type==="vimeo"?e.jsx("iframe",{src:`https://player.vimeo.com/video/${l.id}`,width:"100%",height:"150",frameBorder:"0",allow:"autoplay; fullscreen; picture-in-picture",allowFullScreen:!0,title:s.name}):e.jsx("img",{src:g,alt:s.name}),e.jsx("h2",{children:s.name}),e.jsx("p",{children:s.description}),e.jsxs("p",{children:["Precio: $",s.price?s.price.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}):"N/A"]}),e.jsxs("p",{children:["Stock: ",s.stock]}),e.jsxs("p",{children:["Categoría: ",s.category]}),e.jsxs("p",{children:["Marca: ",s.brand]}),s.price>0&&e.jsxs("div",{className:"credit-info",children:[e.jsxs("p",{children:["Enganche: ",e.jsxs("strong",{children:["$",q.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("p",{children:["Pago Semanal: ",e.jsxs("strong",{children:["$",O.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2})," (17 semanas)"]})]})]}),e.jsxs("div",{className:"product-actions",children:[U(["super_admin","regular_admin","inventory_admin"])&&e.jsx("button",{onClick:()=>y(s),children:"Editar"}),U("super_admin")&&e.jsx("button",{className:"delete-button",onClick:()=>t(s.id),children:"Eliminar"})]})]},s.id)})}),m>1&&e.jsxs("div",{className:"pagination-controls",children:[e.jsx("button",{onClick:()=>o(s=>Math.max(s-1,1)),disabled:d===1,children:"Anterior"}),e.jsxs("span",{children:["Página ",d," de ",m," (",a," ítems)"]}),e.jsx("button",{onClick:()=>o(s=>Math.min(s+1,m)),disabled:d===m,children:"Siguiente"})]})]})]})}export{H as default};
