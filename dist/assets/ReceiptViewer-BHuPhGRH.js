import{r as f,j as e,y as r}from"./index-D3s1T9TP.js";import{d,u as $,t as S}from"./timezone-D8uTpChD.js";import{h as M,E as P}from"./jspdf.es.min-zq-KNx7Z.js";d.extend($);d.extend(S);const j="America/Mexico_City";function C({sale:n,onClose:p}){const l=f.useRef(),x="CelExpress Pro Powered by Leonardo Luna",s={name:"Celexpress Tu Tienda de Celulares",address:"Morelos Sn.col.Centro Juchitepec,EdoMex",phone:"56 66548 9522",email:"contacto@tuempresa.com"};if(!n)return e.jsx("div",{className:"receipt-modal-overlay",children:e.jsxs("div",{className:"receipt-modal-content",children:[e.jsx("button",{className:"close-button",onClick:p,children:"×"}),e.jsx("h3",{children:"Error en Recibo"}),e.jsx("p",{children:"No se seleccionó ninguna venta válida para generar el recibo."})]})});const g=async()=>{if(!l.current){r.error("No se pudo capturar el contenido del recibo.");return}r.info("Generando PDF del recibo...");try{const t=await M(l.current,{scale:2}),i=t.toDataURL("image/png"),o=new P("p","mm","a4"),m=210,u=297,c=t.height*m/t.width;let a=c,h=0;for(o.addImage(i,"PNG",0,h,m,c),a-=u;a>=0;)h=a-c,o.addPage(),o.addImage(i,"PNG",0,h,m,c),a-=u;o.save(`recibo_venta_${n.id}.pdf`),r.success("Recibo PDF generado con éxito!")}catch(t){console.error("Error al generar PDF:",t),r.error("Error al generar el recibo PDF.")}},b=()=>{const t=n.client?n.client.name:"Estimado Cliente",i=n.client?n.client.phone:"";if(!i){r.error("El cliente no tiene un número de teléfono registrado.");return}const o=`¡Hola ${t}! Aquí está tu recibo de venta #${n.id} de ${x}. Monto Total: $${n.totalAmount.toLocaleString("es-MX",{minimumFractionDigits:2})}. Saldo Pendiente: $${n.balanceDue.toLocaleString("es-MX",{minimumFractionDigits:2})}. ¡Gracias por tu compra!`;window.open(`https://wa.me/${i}?text=${encodeURIComponent(o)}`,"_blank"),r.info("Se abrió WhatsApp con el mensaje. Envía el mensaje manualmente si es necesario.")},D=()=>{const t=n.client?n.client.phone:"";if(!t){r.error("El cliente no tiene un número de teléfono registrado.");return}const i=`Recibo venta #${n.id} ${x}. Total: $${n.totalAmount.toLocaleString("es-MX",{minimumFractionDigits:2})}. Saldo: $${n.balanceDue.toLocaleString("es-MX",{minimumFractionDigits:2})}.`;window.open(`sms:${t}?body=${encodeURIComponent(i)}`,"_blank"),r.info("Se abrió la aplicación de SMS. Envía el mensaje manualmente si es necesario.")};return e.jsx("div",{className:"receipt-modal-overlay",children:e.jsxs("div",{className:"receipt-modal-content",children:[e.jsx("button",{className:"close-button",onClick:p,children:"×"}),e.jsxs("h3",{children:["Recibo de Venta #",n.id]}),e.jsxs("div",{ref:l,className:"receipt-body",children:[e.jsxs("div",{className:"receipt-header",children:[e.jsx("h2",{children:s.name}),e.jsx("p",{children:s.address}),e.jsxs("p",{children:["Tel: ",s.phone," | Email: ",s.email]}),e.jsx("hr",{})]}),e.jsxs("div",{className:"receipt-details",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha:"})," ",d(n.saleDate).tz(j).format("DD/MM/YYYY HH:mm")]})," ",e.jsxs("p",{children:[e.jsx("strong",{children:"Venta ID:"})," ",n.id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Atendido por:"})," Administrador"]}),e.jsx("hr",{}),e.jsx("p",{children:e.jsx("strong",{children:"Producto(s):"})}),e.jsx("ul",{className:"receipt-product-list",children:n.saleItems&&n.saleItems.length>0?n.saleItems.map((t,i)=>e.jsx("li",{children:t.product?`${t.product.name} (x${t.quantity})`:`Producto ID ${t.productId} (x${t.quantity})`},t.id||i)):e.jsx("li",{children:"N/A"})}),e.jsx("hr",{}),e.jsxs("p",{children:[e.jsx("strong",{children:"Monto Total de Venta:"})," ",e.jsxs("h2",{children:["$",n.totalAmount.toLocaleString("es-MX",{minimumFractionDigits:2})]})]}),n.isCredit?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Tipo de Venta:"})," Crédito"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Enganche:"})," $",n.downPayment.toLocaleString("es-MX",{minimumFractionDigits:2})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Saldo Pendiente:"})," $",n.balanceDue.toLocaleString("es-MX",{minimumFractionDigits:2})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Pago Semanal:"})," $",n.weeklyPaymentAmount.toLocaleString("es-MX",{minimumFractionDigits:2})," (",n.numberOfPayments," pagos)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Tasa Interés Anual:"})," ",n.interestRate*100,"%"]}),n.payments&&n.payments.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{children:"Pagos Realizados:"}),e.jsx("ul",{children:n.payments.map(t=>e.jsxs("li",{children:[d(t.paymentDate).tz(j).format("DD/MM/YYYY HH:mm")," - $",t.amount.toLocaleString("es-MX",{minimumFractionDigits:2})," (",t.paymentMethod,") "]},t.id))})]})]}):e.jsxs("p",{children:[e.jsx("strong",{children:"Tipo de Venta:"})," Contado"]}),e.jsx("hr",{}),e.jsx("p",{className:"receipt-footer-text",children:"¡Gracias por tu compra!"}),e.jsx("p",{className:"receipt-footer-text",children:"Ponte en contacto para cualquier duda."})]})]}),e.jsxs("div",{className:"receipt-actions",children:[e.jsx("button",{onClick:g,children:"Descargar Recibo (PDF)"}),e.jsx("button",{onClick:b,children:"Compartir por WhatsApp"}),e.jsx("button",{onClick:D,children:"Compartir por SMS"})]})]})})}export{C as default};
