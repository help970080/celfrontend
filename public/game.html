<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Atrapa las Paqueter√≠as</title>

  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self' data: blob:;
                 img-src 'self' data: blob:;
                 script-src 'self' 'unsafe-inline' 'unsafe-eval';
                 style-src 'self' 'unsafe-inline';
                 connect-src 'self';
                 frame-ancestors *;">

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    :root { --bg1:#667eea; --bg2:#764ba2; --ink:#1f2251; }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: linear-gradient(135deg, var(--bg1) 0%, var(--bg2) 100%);
      height:100vh; display:flex; justify-content:center; align-items:center; overflow:hidden;
    }
    #gameContainer {
      width: 90%; max-width: 800px; height: 600px;
      background:#fff; border-radius:20px; position:relative; overflow:hidden;
      box-shadow:0 18px 50px rgba(0,0,0,.25);
    }
    /* HUD */
    #hud {
      position:absolute; inset:0 0 auto 0; height:64px; display:flex; align-items:center;
      padding:10px 12px; gap:10px; background:linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.85));
      z-index:5; border-bottom:1px solid rgba(0,0,0,.06);
    }
    .pill {
      background: rgba(102,126,234,.12); color:var(--ink); border:1px solid rgba(102,126,234,.25);
      padding:8px 12px; border-radius:12px; font-weight:700; font-size:14px;
    }
    .spacer { flex:1; }
    .btn {
      border:0; border-radius:12px; padding:10px 16px; font-weight:800; cursor:pointer; font-size:14px;
      box-shadow:0 6px 18px rgba(0,0,0,.12); transition:transform .15s ease;
    }
    .btn:active { transform:translateY(1px); }
    .btn-start { background:linear-gradient(135deg,#f093fb,#f5576c); color:#fff; }
    .btn-restart { background:#eef1ff; color:#3a3f8a; border:1px solid #dadfff; }

    #gameCanvas { width:100%; height:100%; display:block; outline:none; }
    #help {
      position:absolute; right:10px; bottom:10px; z-index:4;
      background:rgba(0,0,0,.55); color:#fff; font-size:12px; padding:7px 10px; border-radius:10px;
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <div id="hud" role="toolbar" aria-label="Controles del juego">
      <div class="pill">üì¶ Puntuaci√≥n: <span id="score">0</span></div>
      <div class="pill">‚ù§Ô∏è Vidas: <span id="lives">3</span></div>
      <div class="spacer"></div>
      <button id="startBtn" class="btn btn-start" type="button">INICIAR</button>
      <button id="restartBtn" class="btn btn-restart" type="button">Reiniciar</button>
    </div>

    <canvas id="gameCanvas" tabindex="0" aria-label="√Årea del juego"></canvas>
    <div id="help">‚Üê ‚Üí o arrastra con el mouse/touch</div>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // --- Configuraci√≥n de "paqueter√≠as" ---
    const COMPANIES = [
      { name: 'DHL',      bg: '#ffcc00', fg: '#1a1a1a' },
      { name: 'ESTAFETA', bg: '#e30613', fg: '#ffffff' },
      { name: 'UPS',      bg: '#351c15', fg: '#f2a900' }
    ];
    const BAD_RATE = 0.18; // 18% "paquete roto"

    // Estado
    let running = false;
    let score = 0, lives = 3;
    const basket = { x:0, y:0, w:120, h:28, speed:10 };
    let items = [];       // ca√≠das (paqueter√≠as o paquete roto)
    let particles = [];
    const keys = {};
    let mouseX = 0;
    let lastSpawn = 0, spawnRate = 1000, difficulty = 1;
    let raf = null;

    // UI
    const scoreEl = document.getElementById('score');
    const livesEl = document.getElementById('lives');
    const startBtn = document.getElementById('startBtn');
    const restartBtn = document.getElementById('restartBtn');

    function resize() {
      canvas.width = canvas.offsetWidth;
      canvas.height = canvas.offsetHeight;
      basket.y = canvas.height - basket.h - 20;
      if (!running) basket.x = canvas.width/2 - basket.w/2;
    }
    resize();
    addEventListener('resize', resize);

    // Controles
    document.addEventListener('keydown', e => { keys[e.key] = true; if (e.key === 'Enter') toggleStart(); });
    document.addEventListener('keyup',   e => { keys[e.key] = false; });
    canvas.addEventListener('mousemove', e => { const r=canvas.getBoundingClientRect(); mouseX = e.clientX - r.left; });
    canvas.addEventListener('touchmove', e => { e.preventDefault(); const r=canvas.getBoundingClientRect(); mouseX = e.touches[0].clientX - r.left; }, {passive:false});

    startBtn.addEventListener('click', toggleStart);
    restartBtn.addEventListener('click', resetGame);

    function toggleStart(){
      if (running) { running = false; if (raf) cancelAnimationFrame(raf), raf=null; startBtn.textContent = 'INICIAR'; }
      else { if (lives<=0) resetGame(); running = true; startBtn.textContent = 'PAUSAR'; canvas.focus();
             if (raf) cancelAnimationFrame(raf); raf = requestAnimationFrame(loop); }
    }

    function resetGame(){
      running = false;
      if (raf) cancelAnimationFrame(raf), raf=null;
      score = 0; lives = 3; items = []; particles = [];
      difficulty = 1; spawnRate = 1000; lastSpawn = 0;
      basket.x = canvas.width/2 - basket.w/2; mouseX = basket.x + basket.w/2;
      updateHUD(); startBtn.textContent = 'INICIAR'; draw();
    }

    function updateHUD(){ scoreEl.textContent = score; livesEl.textContent = lives; }

    // Spawner
    function spawn(ts){
      if (ts - lastSpawn > spawnRate){
        const isBad = Math.random() < BAD_RATE;
        let payload;
        if (isBad){
          payload = { type:'bad', label:'PAQUETE ROTO', bg:'#ff4757', fg:'#ffffff', emoji:'üí•' };
        } else {
          const c = COMPANIES[Math.floor(Math.random()*COMPANIES.length)];
          payload = { type:'good', label:c.name, bg:c.bg, fg:c.fg };
        }
        items.push({
          x: Math.random()*(canvas.width - 140) + 70, // margen
          y: -60,
          w: 140,
          h: 46,
          v: 2 + difficulty * 0.6,
          rot: (Math.random()-0.5)*0.06,
          payload
        });
        lastSpawn = ts;

        // sube dificultad con el puntaje
        if (score>0 && score%10===0){
          spawnRate = Math.max(550, spawnRate - 40);
          difficulty += 0.2;
        }
      }
    }

    function updateBasket(){
      if (keys['ArrowLeft'] || keys['a'] || keys['A']) basket.x -= basket.speed;
      if (keys['ArrowRight']|| keys['d'] || keys['D']) basket.x += basket.speed;
      if (mouseX>0) basket.x += (mouseX - (basket.x + basket.w/2)) * 0.18;
      basket.x = Math.max(0, Math.min(canvas.width - basket.w, basket.x));
    }

    function updateItems(){
      for (let i=items.length-1;i>=0;i--){
        const it = items[i];
        it.y += it.v;

        // colisi√≥n simple (AABB)
        if (it.y + it.h >= basket.y && it.y <= basket.y + basket.h &&
            it.x + it.w >= basket.x && it.x <= basket.x + basket.w){
          if (it.payload.type === 'bad'){ lives--; boom(it.x,it.y); }
          else { score++; spark(it.x,it.y); }
          items.splice(i,1); updateHUD();
          if (lives<=0){ running=false; startBtn.textContent='INICIAR'; }
          continue;
        }

        // se fue
        if (it.y > canvas.height){
          if (it.payload.type === 'good'){ lives--; updateHUD(); if (lives<=0){ running=false; startBtn.textContent='INICIAR'; } }
          items.splice(i,1);
        }
      }
    }

    // Part√≠culas
    function spark(x,y){ for(let i=0;i<5;i++){ const a=2*Math.PI*i/5; particles.push({x,y,vx:Math.cos(a)*3,vy:Math.sin(a)*3,life:20,type:'star'});} }
    function boom(x,y){ for(let i=0;i<8;i++){ const a=2*Math.PI*i/8; particles.push({x,y,vx:Math.cos(a)*4,vy:Math.sin(a)*4,life:15,type:'expl'});} }
    function updParticles(){ for(let i=particles.length-1;i>=0;i--){ const p=particles[i]; p.x+=p.vx; p.y+=p.vy; if(--p.life<=0) particles.splice(i,1);} }

    // Dibujo
    function drawBackground(){
      ctx.fillStyle='#f0f4ff'; ctx.fillRect(0,0,canvas.width,canvas.height);
    }
    function drawBasket(){
      ctx.fillStyle='#667eea'; ctx.fillRect(basket.x,basket.y,basket.w,basket.h);
      ctx.fillStyle='#4c5fd7'; ctx.fillRect(basket.x,basket.y,basket.w,6);
      ctx.fillRect(basket.x,basket.y,4,basket.h);
      ctx.fillRect(basket.x + basket.w - 4,basket.y,4,basket.h);
    }
    function drawItems(){
      for(const it of items){
        ctx.save();
        ctx.translate(it.x + it.w/2, it.y + it.h/2);
        ctx.rotate(it.rot);
        // tarjeta
        ctx.fillStyle = it.payload.bg;
        roundRect(-it.w/2, -it.h/2, it.w, it.h, 10);
        ctx.fill();

        // texto
        ctx.font = (it.payload.type==='good' ? 'bold 22px Arial' : 'bold 18px Arial');
        ctx.fillStyle = it.payload.fg;
        ctx.textAlign='center'; ctx.textBaseline='middle';
        const label = it.payload.type==='bad' ? `${it.payload.emoji} ${it.payload.label}` : it.payload.label;
        ctx.fillText(label, 0, 2);
        ctx.restore();
      }
    }
    function drawParticles(){
      for(const q of particles){
        ctx.save(); ctx.globalAlpha = (q.type==='star'? q.life/20 : q.life/15);
        if (q.type==='star'){ ctx.fillStyle='#ffd700'; ctx.beginPath(); ctx.arc(q.x,q.y,4,0,Math.PI*2); ctx.fill(); }
        else { ctx.fillStyle='#ff4757'; ctx.fillRect(q.x-3,q.y-3,6,6); }
        ctx.restore();
      }
    }
    function roundRect(x,y,w,h,r){
      const rr = Math.min(r, w/2, h/2);
      ctx.beginPath();
      ctx.moveTo(x+rr,y);
      ctx.arcTo(x+w,y,x+w,y+h,rr);
      ctx.arcTo(x+w,y+h,x,y+h,rr);
      ctx.arcTo(x,y+h,x,y,rr);
      ctx.arcTo(x,y,x+w,y,rr);
      ctx.closePath();
    }

    function draw(){
      drawBackground();
      drawBasket();
      drawItems();
      drawParticles();
    }

    function loop(ts=0){
      if (!running) { draw(); return; }
      spawn(ts); updateBasket(); updateItems(); updParticles(); draw();
      raf = requestAnimationFrame(loop);
    }

    // Estado inicial
    resetGame();
  </script>
</body>
</html>
